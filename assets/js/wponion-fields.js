"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i};!function(e,i,s,p,n,c){var l=c.hooks;n.fn.inputmask=function(){if(0<this.elem.length){var i=this.arg("inputmask");i&&(i=p.validate_js_function(i),this.elem.inputmask(i),this.save(i),this.save_arg("inputmask",i))}return this},n.fn.field_debug=function(){if(0<this.elem.find(".wponion-field-debug").length){var i=this.elem,n=i.find(".wponion-element.wponion-field-debug").find(".wponion-field-title h4");n.attr("title",p.txt("click_to_view_debug_info","Click To View Field Debug Info")),n.tippy({arrow:!0,arrowType:"round",placement:"bottom",theme:"light",animation:"scale"}),i.find(".wponion-field-debug .wponion-field-title h4").on("click",function(){var n=p._get_debug_info(s(this).parent().parent(),{}),i=p.field_js_id(s(this).parent().parent())+"debugINFO",e="<p class='wponion-field-debug-notice'>"+p.settings("debug_notice")+"</p>",t=s("<div id='"+i+"' class='wponion-field-debug-popup' ><div id='"+i+"' ></div> "+e+"</div>");swal({html:t,showConfirmButton:!0,confirmButtonText:p.txt("get_json_output","Get JSON Output"),showCloseButton:!1,width:"800px",onOpen:function(){s("#swal2-content > div > #"+i).jsonView(n)}}).then(function(i){i.value&&swal({width:"600px",html:'<textarea style="min-width:550px; min-height:300px">'+JSON.stringify(n)+"</textarea>"})})})}return this},n.fn.icon_picker=function(){var i=this,n=i.elem,o=i.args(),t=n.find(".wponion-icon-picker-input"),e=n.find("button[data-wponion-iconpicker-remove]"),a=n.find("button[data-wponion-iconpicker-add]"),l=n.find("span.wponion-icon-preview"),r={elems:null,popup:null,popupel:null,init_tooltip:function(){if("false"!==o.popup_tooltip){var i="object"===_typeof(o.popup_tooltip)?o.popup_tooltip:{};0<r.elems.length&&r.elems.tippy(i)}},init:function(i,n){r.popupel=i,r.popup=n,r.elems=r.popupel.find("span.wponion-icon-preview");var e=r.popupel.find(".wponion-icon-picker-container-scroll").css("height");r.popupel.find(".wponion-icon-picker-container-scroll").css("height",e),r.select(),r.input(),r.elems.on("click",function(){var i=s(this).attr("data-icon");t.val(i).trigger("change"),swal.closeModal()}),r.init_tooltip()},input:function(){r.popupel.find("div.wponion-icon-picker-model-header input[type=text]").on("keyup",function(){var i=s(this).val();r.elems.each(function(){s(this).attr("data-icon").search(new RegExp(i,"i"))<0?s(this).parent().hide():s(this).parent().show()})})},select:function(){r.popupel.find("div.wponion-icon-picker-model-header select").on("change",function(){swal.enableLoading();var i=s(this).val();p.ajax("icon_picker",{data:{"wponion-icon-lib":i,enabled:o.enabled,disabled:o.disabled}},function(i){i.success?(swal.resetValidationError(),s(r.popupel).find("#swal2-content").html(i.data).show(),s(r.popupel).find("#swal2-content .wponion-icon-picker-container-scroll"),r.init(r.popupel,r.popup)):(s(r.popupel).find(".wponion-icon-picker-container-scroll").remove(),r.popup.showValidationError(i.data))},function(){r.popup.showValidationError(p.txt("unknown_ajax_error"))},function(){r.popup.disableLoading()})})}};return""===t.val()&&(e.hide(),l.hide()),t.on("keyup blur change keypress",function(){var i=s(this).val();""!==i?(l.html('<i class="'+i+'"></i>').show(),e.show()):(l.hide(),e.hide())}),a.on("click",function(){var t=swal({title:n.find(".wponion-field-title h4").html(),animation:!1,allowOutsideClick:!1,showConfirmButton:!1,showCloseButton:!0,width:"700px",customClass:"wponion-icon-picker-model",onBeforeOpen:function(e){swal.enableLoading(),i.ajax("icon_picker",{onSuccess:function(i){if(i.success){swal.resetValidationError();var n=s(e);n.find("#swal2-content").html(i.data).show(),n.find("#swal2-content .wponion-icon-picker-container-scroll"),r.init(n,t)}else p.tost({type:"error",title:i.data}),t.showValidationError(i.data)},onError:function(){t.showValidationError(p.txt("unknown_ajax_error"))},onAlways:function(){t.disableLoading()},data:{enabled:o.enabled,disabled:o.disabled}})}})}),e.on("click",function(){t.val(""),l.hide(),e.hide()}),this},n.fn.select2=function(){var i=this.arg("select2",{});return i=p.validate_js_function(i),this.save(this.elem.select2(i)),this},n.fn.chosen=function(){var i=this.arg("chosen");return p.__plugin_debug_info(this.elem,"chosen",i),this.save(this.elem.chosen(i)),this},n.fn.selectize=function(){var i=this.arg("selectize");return void 0!==i.theme?this.elem.parent().addClass(i.theme):this.elem.parent().addClass("selectize-default"),this.elem.removeClass("form-control"),this.save(this.elem.selectize(i)),this},n.fn.clone_element=function(){var i=this,n=i.elem,e=n.find("div.wponion-clone-wrap"),t=n.find("button[data-wponion-clone-add]"),o=(e.find("button[data-wponion-clone-remove]"),i.arg("clone")),a=void 0!==o.limit&&o.limit,l=void 0===o.toast_error||o.toast_error,r=o.error_msg,d=!1!==o.sort&&{items:".wponion-field-clone",handle:".wponion-field-clone-sorter",placeholder:"wponion-cloner-placeholder",start:function(i,n){n.item.css("background-color","#eeee")},stop:function(i,n){n.item.removeAttr("style")}};e.WPOnionCloner({add_btn:t,limit:a,clone_elem:".wponion-field-clone",remove_btn:"a.wponion-remove",template:i.arg("clone_template"),templateAfterRender:function(i){var n=i.find("> div.wponion-field-clone:last-child");wponion_field(n).reload()},sortable:d,onLimitReached:function(){if(!0===l)p.tost({type:"error",title:r});else{var i=s('<div class="alert alert-warning" role="alert">'+r+"</div>").hide();t.parent().prepend(i),t.parent().find("div.alert").fadeIn(function(){var i=s(this);setTimeout(function(){i.fadeOut("slow",function(){i.remove()})},1e3)})}},show_animation:o.animations.show,hide_animation:o.animations.hide})},n.fn.field_tooltip=function(){var i=this.elem.attr("data-field-jsid"),r={},n=!0===this.elem.hasClass("wponion-help")?"field_help":i+"tooltip",e=!0===$wponion.valid_json(i)?JSON.parse(i):this.arg(n,!1);return!1===e&&($wponion.valid_json(this.elem.attr("data-tippy"))?e=JSON.parse(this.elem.attr("data-tippy")):$wponion.valid_json(this.elem.attr("data-tippy-args"))?e=JSON.parse(this.elem.attr("data-tippy-args")):$wponion.valid_json(this.elem.attr("tippy-args"))&&(e=JSON.parse(this.elem.attr("tippy-args")))),e&&(e.performance=!1,void 0!==e.image&&!1!==e.image&&(e.html="#wpotpimg",e.updateDuration=2e3,e.onShow=function(a){var l=this.querySelector(".tippy-content");r.loading||(r.loading=!0,fetch(e.image).then(function(i){return i.blob()}).then(function(i){var n,e,t,o=URL.createObjectURL(i);l.innerHTML='<img src="'+o+'">',n=l.querySelector("img"),e=a.popperInstance.update,t=setInterval(function(){n.naturalWidth&&(clearInterval(t),e())},5),r.loading=!1}).catch(function(i){l.innerHTML="Loading failed",r.loading=!1}))},e.onHidden=function(){this.querySelector(".tippy-content").innerHTML=""},e.popperOptions={modifiers:{preventOverflow:{enabled:!1},hide:{enabled:!1}}})),this.elem.tippy(e),this.save(this.elem.tippy_get()),this},n.fn.font_selector=function(){var i=this.elem,n=i.find("select.wponion-font-selector"),e=i.find("select.wponion-variant-selector"),t=p.js_args("wponion_websafe_fonts"),o=p.js_args("wponion_gfonts"),a=function(i){var n="";for(var e in i)n+='<option value="'+e+'">'+i[e]+"</option>";return n};return n.on("change",function(){var i=s(this).val(),n=null;void 0!==t.fonts[i]?n=a(t.variants):void 0!==o[i]&&(n=a(o[i])),e.html(n),p.trigger_update_select(e)}),this},n.fn.accordion=function(){this.elem.each(function(){s(this).find(".wponion-accordion-wrap").each(function(){s(this).accordion({header:"> .wponion-accordion-title",collapsible:!0,animate:250,heightStyle:"content",active:s(this).hasClass("is_open"),icons:{header:"dashicons dashicons-arrow-right",activeHeader:"dashicons dashicons-arrow-down"}})})})},n.fn.group=function(){var i=this.elem,n=i.find("> .wponion-fieldset > button[data-wponion-group-add]"),e=i.find("> .wponion-fieldset > .wponion-group-wrap"),t=this.arg("limit"),o=this.arg("error_msg");wponion_field(i).accordion(),i.find(".wponion-group-remove").tippy(),i.on("click",".wponion-group-remove",function(){s(this).parent().parent().find("> .wponion-accordion-content > .wponion-group-action > button").click()}),e.WPOnionCloner({add_btn:n,limit:parseInt(t),clone_elem:"> .wponion-fieldset > .wponion-accordion-wrap",remove_btn:".wponion-group-action > button",template:this.arg("group_template"),onRemove:function(i){i.parent().parent().parent().remove(),0===s("body").find("link#editor-buttons-css").length&&s("body").append('<link rel="stylesheet" id="editor-buttons-css" href="'+p.settings("wpeditor_buttons_css")+'" type="text/css" media="all">')},templateAfterRender:function(i){var n=e.find("> .wponion-accordion-wrap:last-child");wponion_field(e).accordion(),n.find(".wponion-group-remove").tippy(),wponion_field(n).reload(),wponion_field(n.find(".wponion-element-wp_editor")).reload_wp_editor()},sortable:{items:".wponion-accordion-wrap",handle:".wponion-accordion-title",placeholder:"wponion-accordion-placeholder",start:function(i,n){n.item.css("background-color","#eeee")},stop:function(i,n){n.item.removeAttr("style")}},onLimitReached:function(){var i=s('<div class="alert alert-warning" role="alert">'+o+"</div>").hide();n.before(i),n.parent().find("div.alert").fadeIn(function(){var i=s(this);setTimeout(function(){i.fadeOut("slow",function(){i.remove()})},1e3)})}})},n.fn.wp_links=function(){var n=this.elem,i=n.find("textarea");return n.find("#wponion-wp-link-picker > button").on("click",function(){i.val(""),(!e.wpLink&&s.fn.wpdialog&&s("#wp-link").length?{$link:!1,open:function(){this.$link=s("#wp-link").wpdialog({title:wpLinkL10n.title,width:480,height:"auto",modal:!0,dialogClass:"wp-dialog",zIndex:3e5})},close:function(){this.$link.wpdialog("close")}}:e.wpLink).open(i.attr("id"))}),i.on("change",function(){var i=s(s(this).val());n.find("span.example_output span.value").html(s(this).val()),n.find("input#url").val(i.attr("href")),n.find("input#title").val(i.text()),n.find("input#target").val(i.attr("target")),n.find("span.url span.value").html(i.attr("href")),n.find("span.title span.value").html(i.text()),n.find("span.target span.value").html(i.attr("target"))}),this},n.fn.keyvalue_pair=function(){var i=this.elem;i.find(".wponion-keyvalue_wrap").WPOnionCloner({add_btn:i.find(".wponion-fieldset > .wponion-keyvalue-action-container  > button[data-wponion-keyvalue-add]"),limit:!1,clone_elem:"> .wponion-fieldset > .wponion-keyvalue-field",remove_btn:".wponion-keyvalue-field > button[data-wponion-keyvalue-remove]",template:this.arg("html_template"),templateAfterRender:function(i){l.doAction("wponion_key_value_updated",i)},onRemove:function(i){i.parent().remove(),l.doAction("wponion_key_value_updated",i)}})},n.fn.jquery_tab=function(){var e=this.elem,i=e.find("> .wponion-fieldset > .wponion-tab-wrap ");i.find("> ul.wponion-tab-menus li a").on("click",function(i){i.preventDefault(),s(this).parent().parent().find(".wponion-tab-current").removeClass("wponion-tab-current"),s(this).parent().addClass("wponion-tab-current"),e.find(".wponion-tab-page").hide(),e.find(".wponion-tab-page").removeClass("wponion-tab-current");var n=s(this).attr("data-tab-name");e.find("div#wponion-tab-"+n).addClass("wponion-tab-current").show()}),0<i.find("> ul.wponion-tab-menus li.current").length?i.find("> ul.wponion-tab-menus li.current a").trigger("click"):i.find("> ul.wponion-tab-menus li:first-child a").trigger("click")},n.fn.image_popup=function(i){swal({imageUrl:i,animation:!1,background:"transparent",showConfirmButton:!1,backdrop:"rgba(0,0,0,0.44)"})},n.fn.image_upload=function(){var e=this,i=e.elem,t=i.find("input#image_id"),n=i.find(".wponion-image-preview .wponion-preview-add"),o=i.find(".wponion-image-preview .wponion-preview"),a=void 0;t.on("change",function(){""===s(this).val()?(o.hide(),n.show()):(n.hide(),o.show()),l.doAction("wponion_image_upload_updated",t,o,n)}),n.on("click",function(){void 0!==c&&c.media&&c.media.gallery&&(a||(a=c.media({library:{type:"image"}})).on("select",function(){var i=a.state().get("selection").first().attributes,n=void 0!==i.sizes&&void 0!==i.sizes.thumbnail?i.sizes.thumbnail.url:i.url;o.find("img").attr("src",n).attr("data-fullsize",i.url),t.val(i.id).trigger("change")}),a.open())}),o.find(".wponion-image-remove").on("click",function(){t.val("").trigger("change")}),o.on("click","img",function(){var i=s(this),n=void 0!==i.attr("data-fullsize")?i.attr("data-fullsize"):i.attr("src");e.image_popup(n)})},n.fn.gallery=function(){var e=this,i=e.elem,o=e.arg("html_template"),a=i.find("input#image_id"),l=i.find(".wponion-image-preview"),r=void 0,n=i.find("button[data-wponion-gallery-add]"),t=i.find("button[data-wponion-gallery-edit]"),d=i.find("button[data-wponion-gallery-clear]"),p=function(i){var n=a.val(),e="edit"===i?"edit":"add",t="add"!==e||n.length?"gallery-edit":"gallery";void 0!==c&&c.media&&c.media.gallery&&(l.html(""),"gallery"===t?(r=c.media({library:{type:"image"},frame:"post",state:"gallery",multiple:!0})).open():(r=c.media.gallery.edit('[gallery ids="'+n+'"]'),"add"===e&&r.setState("gallery-library")),r.on("update",function(i){var n=i.models.map(function(i){var n=i.toJSON();if(void 0===n.sizes)return!1;var e=void 0!==n.sizes.thumbnail?n.sizes.thumbnail.url:n.url,t=s(o);return t.attr("data-wponion-image_id",n.id),t.find("img").attr("data-fullsize",n.url).attr("src",e).removeClass("hidde"),l.append(t),l.find(".wponion-help").tippy(),n.id}),e=void 0;for(e in n)!1!==n[e]&&""!==n[e]||delete n[e];a.val(n.join(",")).trigger("change")}))};a.on("change",function(){""===s(this).val()?(n.show(),t.hide(),d.hide()):(t.show(),d.show(),n.hide())}),n.on("click",function(){p("add")}),t.on("click",function(){p("edit")}),d.on("click",function(){a.val(""),l.html(""),d.hide(),t.hide(),n.show()}),l.on("click","img",function(){var i=s(this),n=void 0!==i.attr("data-fullsize")?i.attr("data-fullsize"):i.attr("src");e.image_popup(n)}),l.on("click","i.wponion-image-remove",function(){var i=s(this).parent(),e=i.attr("data-wponion-image_id"),t=a.val().split(",");s.each(a.val().split(","),function(i,n){n===e&&t.splice(i,1)}),a.val(t.join(",")),i.fadeOut(function(){s(this).remove()}),a.trigger("change")}),a.trigger("change"),l.sortable({items:"> div",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,placeholder:"sortable-placeholder",helper:"clone",opacity:.65,start:function(i,n){var e=n.item;l.find(".sortable-placeholder").css("width",e.width()),l.find(".sortable-placeholder").css("height",e.height())}}),l.on("change",function(){console.log(s(this).html())})},n.fn.color_picker=function(){this.elem.find("input").wpColorPicker()},n.fn.upload=function(){var i=this.elem,n=i.find("button"),e=i.find("input[type=text]"),t=this.args(),o=void 0;n.on("click",function(i){i.preventDefault(),void 0!==c&&c.media&&c.media.gallery&&(o||(o=c.media({title:t.settings.frame_title,library:{type:t.settings.upload_type},button:{text:t.settings.insert_title}})).on("select",function(){var i=o.state().get("selection").first();e.val(i.attributes.url).trigger("change")}),o.open())})},n.fn.date_picker=function(){var i=this.elem,n=this.arg("settings"),e=this.js_id(),t="default";if(void 0!==n.theme&&(t=n.theme,delete n.theme),0===s("div#"+e).length){var o='<div class="wponion-datepicker-'+t+'" id="'+e+'"></div>';s("body").append(s(o))}i.hasClass("wponion-datepicker-range")?(n.appendTo=s("div#"+e)[0],void 0===n.plugins&&(n.plugins=new Array),n.plugins.push(new rangePlugin({input:i.find("input[data-wponion-datepicker-to-date]")[0]})),i.find("input[data-wponion-datepicker-from-date]").flatpickr(n)):(n.appendTo=s("div#"+e)[0],i.find("input").flatpickr(n)),this.save_arg("datepicker",n)},n.fn.reload_wp_editor=function(){if(0<this.elem.length){var i=tinyMCEPreInit.mceInit[this.arg("wpeditor_id")],n=tinyMCEPreInit.qtInit[this.arg("wpeditor_id")],e="WPOGP"+(new Date).valueOf(),t=this.elem.find("textarea").clone(),o=t.attr("id"),a=this.elem.find(".wponion-fieldset").html(),l=new RegExp(o,"g");a=a.replace(l,e),this.elem.find(".wponion-fieldset").html(a),this.elem.find("textarea").parent().append(t),this.elem.find("textarea:not(#"+o+")").remove(),this.elem.find("textarea").attr("id",e),void 0!==i&&(i.selector="#"+e,tinymce.init(i),tinyMCE.execCommand("mceAddEditor",!1,"#"+e)),void 0!==n&&(n.id=e,quicktags(n))}},n.fn.checkbox_radio=function(){if(0<this.elem.find("input.wponion-custom-value-input").length){var i=this.elem.find("input.wponion-custom-value-input");this.elem.find("input[type=radio]").on("click",function(){i.removeAttr("name")}),i.on("click",function(){s(this).parent().find("input[type=radio],input[type=checkbox]").prop("checked",!0),s(this).attr("name",s(this).attr("data-name"))}),i.on("change",function(){})}},n.fn.reload=function(){l.addAction("wponion_before_fields_reload"),this.init_field("input[data-wponion-inputmask]","inputmask"),this.init_field(".wponion-element-icon_picker","icon_picker"),this.init_field(".select2","select2"),this.init_field(".chosen","chosen"),this.init_field(".selectize","selectize"),this.init_field(".wponion-element-accordion","accordion"),this.init_field(".wponion-element-group","group"),this.init_field(".wponion-element-clone","clone_element"),this.init_field(".wponion-field-tooltip","field_tooltip"),this.init_field(".wponion-element-font_picker","font_selector"),this.init_field(".wponion-element-wp_link","wp_links"),this.init_field(".wponion-element-key_value","keyvalue_pair"),this.init_field(".wponion-element-tab","jquery_tab"),this.init_field(".wponion-element-image","image_upload"),this.init_field(".wponion-element-gallery","gallery"),this.init_field(".wponion-element-color_picker","color_picker"),this.init_field(".wponion-element-upload","upload"),this.init_field(".wponion-element-date_picker","date_picker"),this.init_field(".wponion-element-radio","checkbox_radio"),this.init_field(".wponion-element-checkbox","checkbox_radio"),this.init_field(".wponion-help","field_tooltip"),this.field_debug(),l.addAction("wponion_after_fields_reload")},n.fn.dependency=function(i){var n=this.arg("dependency");for(var e in n.controller){var t=n.controller[e],o=n.condition[e],a=n.value[e];(i=i.createRule('[data-depend-id="'+t+'"]',o,a)).include(s(this.elem))}},s.fn.wponion_dependency=function(i,n){var e={};e.$el=void 0===i?s(this):i,e.init=function(){e.ruleset=s.deps.createRuleset();void 0!==n||e.depRoot(),s.deps.enable(e.$el,e.ruleset,{show:function(i){i.removeClass("hidden")},hide:function(i){i.addClass("hidden")},log:!0,checkTargets:!1})},e.depRoot=function(){e.$el.each(function(){s(this).find(".wponion-has-dependency").each(function(){wponion_field(s(this)).dependency(e.ruleset)})})},e.init()},l.addAction("wponion_before_init",function(){0===s("#wpotpimg").length&&s("body").append(s('<div id="wpotpimg" style="display: none;min-width:300px;min-height:400px;">..</div>'));var i=s(".wponion-framework");0<i.length&&(i.wponion_dependency(),wponion_field(".wponion-framework").reload())})}(window,document,jQuery,$wponion,$wponion_field,wp);